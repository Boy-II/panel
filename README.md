# BWC å°ˆæ¡ˆç›£æ§å„€è¡¨æ¿

> ğŸš€ ä¸€å€‹åŸºæ–¼ Next.js çš„å°ˆæ¡ˆç›£æ§å„€è¡¨æ¿ï¼Œå¾ Notion è³‡æ–™åº«ç²å–è³‡æ–™ï¼Œæä¾›å³æ™‚å°ˆæ¡ˆç‹€æ…‹ç›£æ§ã€æ™‚é–“ç®¡ç†å’Œè³‡æ–™è¦–è¦ºåŒ–åŠŸèƒ½ã€‚

![Next.js](https://img.shields.io/badge/Next.js-15-black)
![TypeScript](https://img.shields.io/badge/TypeScript-5.0-blue)
![Tailwind CSS](https://img.shields.io/badge/Tailwind-3.4-38bdf8)

## ğŸ“¸ é è¦½

- **å…¨å±€å„€è¡¨æ¿**ï¼šæŸ¥çœ‹æ‰€æœ‰å°ˆæ¡ˆçš„æ•´é«”ç‹€æ…‹
- **å€‹äººå„€è¡¨æ¿**ï¼šæŸ¥çœ‹å€‹äººè² è²¬å°ˆæ¡ˆçš„è©³ç´°è³‡è¨Š
- **å³æ™‚ç›£æ§**ï¼šè‡ªå‹•æ›´æ–°ï¼ŒæŒæ¡æœ€æ–°ç‹€æ…‹

## âœ¨ åŠŸèƒ½ç‰¹è‰²

### é›™é‡è¦–åœ–
- **å…¨å±€å„€è¡¨æ¿**ï¼šæŸ¥çœ‹æ‰€æœ‰å°ˆæ¡ˆçš„æ•´é«”ç‹€æ…‹å’Œçµ±è¨ˆ
- **å€‹äººå„€è¡¨æ¿**ï¼šé¸æ“‡ç‰¹å®šè¨­è¨ˆå¸«æˆ–ç·¨è¼¯ï¼ŒæŸ¥çœ‹å…¶è² è²¬çš„å°ˆæ¡ˆ

### æ™ºèƒ½æ™‚é–“ç®¡ç†
- âœ… è‡ªå‹•è¨ˆç®—å°ˆæ¡ˆå‰©é¤˜å¤©æ•¸
- ğŸ”´ é€¾æœŸå°ˆæ¡ˆè­¦ç¤ºï¼ˆç´…è‰²ï¼‰
- ğŸŸ  ç·Šæ€¥å°ˆæ¡ˆæé†’ï¼ˆ3å¤©å…§ï¼Œæ©™è‰²ï¼‰
- ğŸŸ¡ è­¦å‘Šå°ˆæ¡ˆæ¨™è¨˜ï¼ˆ7å¤©å…§ï¼Œé»ƒè‰²ï¼‰
- âšª å·²éæœŸå°ˆæ¡ˆæ­¸æª”ï¼ˆè¶…é365å¤©ï¼Œç°è‰²ï¼Œä¸è¨ˆå…¥çµ±è¨ˆï¼‰

### è³‡æ–™è¦–è¦ºåŒ–
- ğŸ“Š æ™‚é–“ç‹€æ…‹åˆ†å¸ƒåœ–
- ğŸ“ˆ é€šçŸ¥ç‹€æ…‹åˆ†å¸ƒåœ–
- ğŸ“‰ å°ˆæ¡ˆå‹æ…‹åˆ†å¸ƒåœ–

### æœå°‹èˆ‡ç¯©é¸
- ğŸ” é—œéµå­—æœå°‹ï¼ˆå°ˆæ¡ˆåç¨±ã€ç·¨è¼¯ã€è¨­è¨ˆå¸«ï¼‰
- ğŸ¯ å¤šç¶­åº¦ç¯©é¸ï¼ˆé€šçŸ¥ç‹€æ…‹ã€å°ˆæ¡ˆå‹æ…‹ã€æ™‚é–“ç‹€æ…‹ï¼‰
- ğŸ“‹ å³æ™‚çµæœæ›´æ–°

### å³æ™‚ç›£æ§
- â° è‡ªå‹•æ¯60ç§’åˆ·æ–°è³‡æ–™
- ğŸ”„ æ‰‹å‹•åˆ·æ–°æŒ‰éˆ•
- ğŸ“… é¡¯ç¤ºæœ€å¾Œæ›´æ–°æ™‚é–“

### å®Œæ•´åˆ†é æ”¯æŒ
- ğŸ“„ è‡ªå‹•è™•ç† Notion API åˆ†é 
- â™¾ï¸ æ”¯æŒä»»æ„æ•¸é‡çš„å°ˆæ¡ˆè¨˜éŒ„

## æŠ€è¡“æ£§

- **å‰ç«¯æ¡†æ¶**ï¼šNext.js 15 (App Router)
- **UI æ¨£å¼**ï¼šTailwind CSS
- **åœ–è¡¨åº«**ï¼šRecharts
- **åœ–æ¨™**ï¼šLucide React
- **è³‡æ–™ä¾†æº**ï¼šNotion API (@notionhq/client)
- **è³‡æ–™åº«**ï¼šPostgreSQL (pg)
- **èªè¨€**ï¼šTypeScript

## æ¶æ§‹èªªæ˜

### è³‡æ–™æµç¨‹

```
Notion Database â†’ Sync API â†’ PostgreSQL â†’ Read APIs â†’ Frontend
```

1. **Notion ä½œç‚ºè³‡æ–™ä¾†æº**ï¼šæ‰€æœ‰å°ˆæ¡ˆè³‡æ–™å­˜å„²åœ¨ Notion è³‡æ–™åº«ä¸­
2. **PostgreSQL ä½œç‚ºå¿«å–å±¤**ï¼šæä¾›å¿«é€ŸæŸ¥è©¢ï¼Œæ¸›å°‘ Notion API èª¿ç”¨
3. **åŒæ­¥æ©Ÿåˆ¶**ï¼šé€šé API ç«¯é»æ‰‹å‹•æˆ–å®šæ™‚åŒæ­¥ Notion è³‡æ–™åˆ° PostgreSQL
4. **è®€å–å„ªåŒ–**ï¼šæ‰€æœ‰å‰ç«¯æŸ¥è©¢ç›´æ¥å¾ PostgreSQL è®€å–ï¼Œå¤§å¹…æå‡è¼‰å…¥é€Ÿåº¦

## å¿«é€Ÿé–‹å§‹

### 1. ç’°å¢ƒæº–å‚™

ç¢ºä¿å·²å®‰è£ï¼š
- Node.js 18+
- npm æˆ– yarn

### 2. å…‹éš†é …ç›®

```bash
git clone <your-repo-url>
cd panel
```

### 3. å®‰è£ä¾è³´

```bash
npm install
```

### 4. è¨­å®šç’°å¢ƒè®Šæ•¸

è¤‡è£½ `.env.example` ç‚º `.env.local`ï¼š

```bash
cp .env.example .env.local
```

ç·¨è¼¯ `.env.local`ï¼Œå¡«å…¥æ‚¨çš„ Notion å’Œ PostgreSQL è³‡è¨Šï¼š

```env
# Notion API Configuration
NOTION_API_KEY=your_notion_integration_token_here
NOTION_DATABASE_ID=your_database_id_here

# PostgreSQL Database Configuration
DATABASE_URL=postgresql://username:password@host:port/database

# Optional: Refresh interval in milliseconds
REFRESH_INTERVAL=60000
```

#### å¦‚ä½•ç²å– Notion API Keyï¼š

1. å‰å¾€ [Notion Integrations](https://www.notion.so/my-integrations)
2. é»æ“Š "New integration"
3. å¡«å¯«åŸºæœ¬è³‡è¨Šï¼Œé¸æ“‡ä½ çš„å·¥ä½œå€
4. å‰µå»ºå¾Œï¼Œè¤‡è£½ "Internal Integration Token"
5. åœ¨ Notion ä¸­ï¼Œæ‰“é–‹æ‚¨çš„è³‡æ–™åº«é é¢
6. é»æ“Šå³ä¸Šè§’çš„ "..." â†’ "Connections" â†’ æ·»åŠ æ‚¨å‰›å‰µå»ºçš„ integration

#### å¦‚ä½•ç²å– Database IDï¼š

å¾ Notion è³‡æ–™åº« URL ä¸­ç²å–ï¼š
```
https://www.notion.so/workspace/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx?v=...
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                              é€™å°±æ˜¯ Database IDï¼ˆ32ä½å­—ç¬¦ï¼‰
```

**æ­¥é©Ÿï¼š**
1. æ‰“é–‹æ‚¨çš„ Notion è³‡æ–™åº«é é¢
2. è¤‡è£½ç€è¦½å™¨åœ°å€æ¬„ä¸­çš„ URL
3. æ‰¾åˆ° URL ä¸­é–“çš„ 32 ä½å­—ç¬¦ä¸²ï¼ˆç”±å­—æ¯å’Œæ•¸å­—çµ„æˆï¼‰
4. è¤‡è£½ä¸¦è²¼åˆ° `.env.local` çš„ `NOTION_DATABASE_ID` ä¸­

#### å¦‚ä½•è¨­å®š PostgreSQLï¼š

1. åœ¨ Zeabur å‰µå»º PostgreSQL æœå‹™
2. ç²å–é€£æ¥å­—ä¸²ï¼ˆConnection Stringï¼‰
3. è¤‡è£½ä¸¦è²¼åˆ° `.env.local` çš„ `DATABASE_URL` ä¸­

### 5. åˆå§‹åŒ–æ•¸æ“šåº«

é¦–æ¬¡ä½¿ç”¨éœ€è¦åˆå§‹åŒ–æ•¸æ“šåº«è¡¨çµæ§‹ï¼š

```bash
npm run db:init
```

### 6. åŒæ­¥ Notion è³‡æ–™

åˆå§‹åŒ–æ•¸æ“šåº«å¾Œï¼Œéœ€è¦å¾ Notion åŒæ­¥è³‡æ–™ï¼š

```bash
# æ–¹æ³•ä¸€ï¼šå•Ÿå‹•æœå‹™å™¨å¾Œèª¿ç”¨ API
npm run dev
# åœ¨å¦ä¸€å€‹çµ‚ç«¯åŸ·è¡Œï¼š
curl -X POST http://localhost:3000/api/sync

# æ–¹æ³•äºŒï¼šéƒ¨ç½²åˆ° Zeabur å¾Œï¼Œè¨ªå•åŒæ­¥ API
# POST https://your-app.zeabur.app/api/sync
```

### 7. å•Ÿå‹•é–‹ç™¼æœå‹™å™¨

```bash
npm run dev
```

æ‰“é–‹ç€è¦½å™¨è¨ªå• [http://localhost:3000](http://localhost:3000)

### 8. æ§‹å»ºç”Ÿç”¢ç‰ˆæœ¬

```bash
npm run build
npm start
```

## éƒ¨ç½²åˆ° Zeabur

### æ–¹æ³•ä¸€ï¼šé€šé GitHubï¼ˆæ¨è–¦ï¼‰

1. å°‡ä»£ç¢¼æ¨é€åˆ° GitHub å€‰åº«

```bash
git init
git add .
git commit -m "Initial commit"
git remote add origin <your-github-repo-url>
git push -u origin main
```

2. ç™»å…¥ [Zeabur](https://zeabur.com/)

3. å‰µå»ºæ–°å°ˆæ¡ˆï¼š
   - é»æ“Š "New Project"
   - é¸æ“‡ "Deploy from GitHub"
   - é¸æ“‡æ‚¨çš„å€‰åº«

4. æ·»åŠ  PostgreSQL æœå‹™ï¼š
   - åœ¨ Zeabur å°ˆæ¡ˆä¸­é»æ“Š "Add Service"
   - é¸æ“‡ "PostgreSQL"
   - ç­‰å¾… PostgreSQL æœå‹™å•Ÿå‹•

5. è¨­å®šç’°å¢ƒè®Šæ•¸ï¼š
   - åœ¨ Zeabur å°ˆæ¡ˆè¨­å®šä¸­ï¼Œæ·»åŠ ç’°å¢ƒè®Šæ•¸ï¼š
     - `NOTION_API_KEY`
     - `NOTION_DATABASE_ID`
     - `DATABASE_URL`ï¼ˆå¾ PostgreSQL æœå‹™ç²å–ï¼‰
     - `REFRESH_INTERVAL`ï¼ˆå¯é¸ï¼‰

6. éƒ¨ç½²ï¼š
   - Zeabur æœƒè‡ªå‹•æª¢æ¸¬ç‚º Next.js å°ˆæ¡ˆä¸¦éƒ¨ç½²
   - ç­‰å¾…éƒ¨ç½²å®Œæˆï¼Œå³å¯ç²å¾—è¨ªå•ç¶²å€

7. åˆå§‹åŒ–è³‡æ–™åº«èˆ‡åŒæ­¥ï¼š
   ```bash
   # åˆå§‹åŒ–è³‡æ–™åº«è¡¨çµæ§‹ï¼ˆä½¿ç”¨ DATABASE_URLï¼‰
   npm run db:init

   # åŒæ­¥ Notion è³‡æ–™åˆ° PostgreSQL
   curl -X POST https://your-app.zeabur.app/api/sync
   ```

### æ–¹æ³•äºŒï¼šä½¿ç”¨ Zeabur CLI

```bash
# å®‰è£ Zeabur CLI
npm i -g @zeabur/cli

# ç™»å…¥
zeabur auth login

# éƒ¨ç½²
zeabur deploy
```

## å°ˆæ¡ˆçµæ§‹

```
panel/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ projects/           # å°ˆæ¡ˆè³‡æ–™ API
â”‚   â”‚   â”œâ”€â”€ stats/              # çµ±è¨ˆè³‡æ–™ API
â”‚   â”‚   â”œâ”€â”€ people/             # äººå“¡åˆ—è¡¨ API
â”‚   â”‚   â”œâ”€â”€ personal/[person]/  # å€‹äººå„€è¡¨æ¿ API
â”‚   â”‚   â””â”€â”€ sync/               # Notion â†’ PostgreSQL åŒæ­¥ API
â”‚   â”œâ”€â”€ personal/[person]/      # å€‹äººå„€è¡¨æ¿é é¢
â”‚   â”œâ”€â”€ globals.css             # å…¨å±€æ¨£å¼
â”‚   â”œâ”€â”€ layout.tsx              # æ ¹ä½ˆå±€
â”‚   â””â”€â”€ page.tsx                # å…¨å±€å„€è¡¨æ¿é é¢
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Charts.tsx              # åœ–è¡¨çµ„ä»¶
â”‚   â”œâ”€â”€ ProjectTable.tsx        # å°ˆæ¡ˆè¡¨æ ¼çµ„ä»¶
â”‚   â””â”€â”€ StatsCard.tsx           # çµ±è¨ˆå¡ç‰‡çµ„ä»¶
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ notion.ts               # Notion API æ•´åˆ
â”‚   â”œâ”€â”€ db.ts                   # PostgreSQL è³‡æ–™åº«æ“ä½œ
â”‚   â””â”€â”€ cache.ts                # å¿«å–å·¥å…·
â”œâ”€â”€ database/
â”‚   â””â”€â”€ schema.sql              # PostgreSQL è³‡æ–™åº«çµæ§‹
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ init-db.ts              # è³‡æ–™åº«åˆå§‹åŒ–è…³æœ¬
â”œâ”€â”€ .env.example                # ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
â”œâ”€â”€ next.config.js              # Next.js é…ç½®
â”œâ”€â”€ package.json                # ä¾è³´ç®¡ç†
â”œâ”€â”€ tailwind.config.ts          # Tailwind é…ç½®
â””â”€â”€ tsconfig.json               # TypeScript é…ç½®
```

## API è·¯ç”±

### GET /api/projects

ç²å–æ‰€æœ‰å°ˆæ¡ˆè³‡æ–™ï¼ŒåŒ…å«æ™‚é–“ç‹€æ…‹è¨ˆç®—ã€‚

**éŸ¿æ‡‰ç¯„ä¾‹ï¼š**
```json
[
  {
    "id": "...",
    "å°ˆæ¡ˆåç¨±": "ç¯„ä¾‹å°ˆæ¡ˆ",
    "å°ˆæ¡ˆå‹æ…‹": ["æ•¸ä½ç¶²ç«™"],
    "è²¬ä»»ç·¨è¼¯": ["å¼µä¸‰"],
    "è²¬ä»»è¨­è¨ˆ": ["æå››"],
    "é€šçŸ¥ç‹€æ…‹": "å·²é€šçŸ¥",
    "å·¥ä½œåŸ·è¡Œå€é–“": {
      "start": "2024-01-01",
      "end": "2024-12-31"
    },
    "timeStatus": "on-time",
    "daysRemaining": 180
  }
]
```

### GET /api/stats

ç²å–çµ±è¨ˆè³‡æ–™ã€‚

**éŸ¿æ‡‰ç¯„ä¾‹ï¼š**
```json
{
  "total": 100,
  "statusStats": {
    "æœªé€šçŸ¥": 20,
    "é€šçŸ¥ä¸­": 30,
    "å·²é€šçŸ¥": 50
  },
  "typeStats": {
    "æ•¸ä½ç¶²ç«™": 40,
    "ç´™æœ¬": 30,
    "è¨­è¨ˆæ¡ˆ": 30
  },
  "timeStats": {
    "overdue": 5,
    "urgent": 10,
    "warning": 15,
    "onTime": 60,
    "noDeadline": 10
  },
  "designerWorkload": {...},
  "editorWorkload": {...}
}
```

### POST /api/sync

å¾ Notion åŒæ­¥è³‡æ–™åˆ° PostgreSQLã€‚

**è«‹æ±‚ï¼š**
```bash
curl -X POST https://your-app.zeabur.app/api/sync
```

**éŸ¿æ‡‰ç¯„ä¾‹ï¼š**
```json
{
  "success": true,
  "message": "åŒæ­¥æˆåŠŸ",
  "totalProjects": 156,
  "durationMs": 3421
}
```

## è‡ªå®šç¾©é…ç½®

### ä¿®æ”¹åˆ·æ–°é–“éš”

åœ¨ `.env.local` ä¸­è¨­å®š `REFRESH_INTERVAL`ï¼ˆå–®ä½ï¼šæ¯«ç§’ï¼‰ï¼š

```env
REFRESH_INTERVAL=30000  # 30ç§’åˆ·æ–°ä¸€æ¬¡
```

æˆ–åœ¨ `app/page.tsx` ä¸­ç›´æ¥ä¿®æ”¹ï¼š

```typescript
const interval = setInterval(fetchData, 30000); // 30ç§’
```

### è‡ªå®šç¾©æ™‚é–“è­¦å‘Šé–¾å€¼

åœ¨ `app/api/projects/route.ts` ä¸­ä¿®æ”¹ï¼š

```typescript
if (diffDays < 0) {
  status = 'overdue';
} else if (diffDays <= 3) {  // ä¿®æ”¹é€™è£¡ï¼š3å¤©å…§ç‚ºç·Šæ€¥
  status = 'urgent';
} else if (diffDays <= 7) {  // ä¿®æ”¹é€™è£¡ï¼š7å¤©å…§ç‚ºè­¦å‘Š
  status = 'warning';
}
```

## æ³¨æ„äº‹é …

1. **è³‡æ–™åŒæ­¥**ï¼š
   - åˆæ¬¡éƒ¨ç½²å¾Œéœ€è¦æ‰‹å‹•èª¿ç”¨ `/api/sync` ä¾†åŒæ­¥ Notion è³‡æ–™
   - å»ºè­°è¨­å®šå®šæœŸåŒæ­¥ï¼ˆä¾‹å¦‚ä½¿ç”¨ cron job æˆ– Zeabur çš„ scheduled tasksï¼‰
   - å¯ä»¥åœ¨ Notion è³‡æ–™æ›´æ–°å¾Œæ‰‹å‹•è§¸ç™¼åŒæ­¥

2. **Notion API é™åˆ¶**ï¼š
   - Notion API æœ‰è«‹æ±‚é€Ÿç‡é™åˆ¶
   - ä½¿ç”¨ PostgreSQL å¿«å–å¾Œï¼Œåªæœ‰åŒæ­¥æ“ä½œæœƒèª¿ç”¨ Notion API
   - æ‰€æœ‰è®€å–æ“ä½œéƒ½å¾ PostgreSQL è®€å–ï¼Œä¸å— Notion API é™åˆ¶

3. **æ¬Šé™è¨­å®š**ï¼šç¢ºä¿ Notion Integration æœ‰è®€å–è³‡æ–™åº«çš„æ¬Šé™

4. **è³‡æ–™åº«çµæ§‹**ï¼šå¦‚æœæ‚¨çš„ Notion è³‡æ–™åº«çµæ§‹èˆ‡ BWC å°ˆæ¡ˆåˆ—è¡¨ä¸åŒï¼Œéœ€è¦ä¿®æ”¹ `lib/notion.ts` ä¸­çš„å±¬æ€§æ˜ å°„

5. **PostgreSQL é€£æ¥**ï¼šç¢ºä¿ `DATABASE_URL` è¨­å®šæ­£ç¢ºï¼Œä¸¦ä¸” PostgreSQL æœå‹™æ­£å¸¸é‹è¡Œ

## æ•…éšœæ’é™¤

### 1. ç„¡æ³•é€£æ¥ Notion API

- æª¢æŸ¥ `NOTION_API_KEY` æ˜¯å¦æ­£ç¢º
- ç¢ºèª Integration å·²é€£æ¥åˆ°è³‡æ–™åº«
- æª¢æŸ¥ `NOTION_DATABASE_ID` æ˜¯å¦æ­£ç¢º

### 2. åœ–è¡¨ç„¡æ³•é¡¯ç¤º

- ç¢ºèªå·²å®‰è£ `recharts` ä¾è³´
- æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°æ˜¯å¦æœ‰éŒ¯èª¤

### 3. éƒ¨ç½²å¾Œç’°å¢ƒè®Šæ•¸ä¸ç”Ÿæ•ˆ

- ç¢ºèªåœ¨ Zeabur æˆ–å…¶ä»–å¹³å°è¨­å®šäº†ç’°å¢ƒè®Šæ•¸
- é‡æ–°éƒ¨ç½²æ‡‰ç”¨

### 4. PostgreSQL é€£æ¥å¤±æ•—

- æª¢æŸ¥ `DATABASE_URL` æ˜¯å¦æ­£ç¢º
- ç¢ºèª PostgreSQL æœå‹™æ­£å¸¸é‹è¡Œ
- æª¢æŸ¥ SSL è¨­å®šï¼ˆç›®å‰è¨­å®šç‚º `ssl: false`ï¼‰
- ç¢ºèªç¶²è·¯é€£æ¥æ­£å¸¸

### 5. è³‡æ–™ä¸é¡¯ç¤º

- æª¢æŸ¥æ˜¯å¦å·²åŸ·è¡Œè³‡æ–™åº«åˆå§‹åŒ– `npm run db:init`
- æª¢æŸ¥æ˜¯å¦å·²åŒæ­¥ Notion è³‡æ–™ `POST /api/sync`
- æŸ¥çœ‹ç€è¦½å™¨æ§åˆ¶å°å’Œä¼ºæœå™¨æ—¥èªŒ

## æˆæ¬Š

MIT License

## è¯çµ¡æ–¹å¼

å¦‚æœ‰å•é¡Œæˆ–å»ºè­°ï¼Œè«‹é–‹ Issue è¨è«–ã€‚
